# -*- mode: sh -*-
# shellcheck shell=bash

use_omnix() {
  # TODO: Switch to nixpkgs version once we upstream
  # Because, the user may not be a trusted-user leading to compilation!
  nix --accept-flake-config run github:juspay/omnix/om-hack-more -- hack --stage=pre-shell $*

  # Use of --accept-flake-config ensures that configured cache is used to launch the devShell
  # TODO: Run omnix readme step *after* this.
  use flake $* --accept-flake-config

  if [[ ! -z "${NIX_DIRENV_DID_FALLBACK:-}" ]]; then
    # Nix shell failed; move on!
    echo
  else
    nix --accept-flake-config run github:juspay/omnix/om-hack-more -- hack --stage=post-shell $*
  fi
}
